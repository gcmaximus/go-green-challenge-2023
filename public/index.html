<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <!-- CSS -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
        />
        <link href="/style/index.css" rel="stylesheet" />

        <!-- Bootstrap -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
            crossorigin="anonymous"
        />

        <!-- poppins -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Nunito&display=swap"
            rel="stylesheet"
        />

        <!-- Script -->
        <script src="/js/index.js"></script>

        <title>Home</title>
    </head>

    <body>
        <header>
            <!--Navbar-->
            <nav>
                <section class="top-nav">
                    <div>
                        <img
                            src="/img/logo.png"
                            alt="Go-Green Challenge 2023"
                            id="navbar-logo"
                        />
                        <span hidden id="display">
                            <!-- Display Username and Points-->
                            <span id="usernameDisplay"></span>:
                            <span id="totalScoreDisplay"></span> points
                        </span>
                    </div>
                    <input id="menu-toggle" type="checkbox" />
                    <label class="menu-button-container" for="menu-toggle">
                        <div class="menu-button"></div>
                    </label>
                    <ul class="menu">
                        <li><a href="/">Home</a></li>
                        <li>
                            <a href="/leaderboard.html">Leaderboard & Prizes</a>
                        </li>
                        <li>
                            <a href="/ongoing-challenge.html"
                                >Ongoing Challenges</a
                            >
                        </li>
                        <li>
                            <a href="/past-challenges.html">Past Challenges</a>
                        </li>
                        <li><a href="/about-us.html">About Us</a></li>
                        <li hidden id="signOutButton">
                            <button>
                                <i
                                    class="fa fa-sign-out"
                                    style="font-size: 24px"
                                ></i>
                            </button>
                        </li>
                        <li id="signInPageButton">
                            <a href="/login.html">Sign In</a>
                        </li>
                    </ul>
                </section>
            </nav>
        </header>
        <main>
            <!--Home Page Hero Banner-->
            <article class="hero-banner home">
                <h1 class="mb-4">Go-Green Recycling Challenge</h1>
            </article>

            <!--Main Contents-->
            <section class="container">
                <!--Mission-->
                <div class="row">
                    <div class="col-12 mission">
                        <div class="typewriter">
                            <h1>Our Mission</h1>
                        </div>
                        <p>
                            We aim to encourage the public to use less/no
                            plastics in their daily lives as a habit.
                        </p>
                    </div>
                </div>
                <!--3W1H-->
                <div class="row">
                    <div class="col-6 info-card reveal">
                        <div class="row info-card-row">
                            <div class="col-sm-6">
                                <img
                                    src="/img/why.png"
                                    alt="Image"
                                    class="info-card-pic"
                                />
                            </div>
                            <div class="col-sm-6 info-card-text">
                                <h3>Why?</h3>
                                <p>
                                    To reduce the plastic waste and reliance
                                    among public in Singapore and to encourage
                                    recycling for the plastic that is used.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 info-card reveal">
                        <div class="row info-card-row">
                            <div class="col-sm-6">
                                <img
                                    src="/img/what.png"
                                    alt="Image"
                                    class="info-card-pic"
                                />
                            </div>
                            <div class="col-sm-6 info-card-text">
                                <h3>What?</h3>
                                <p>
                                    We have developed challenges that will be
                                    released daily over 4 weeks to help you to
                                    build habits to reduce plastic consumption
                                    in a competitive style.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 info-card reveal">
                        <div class="row info-card-row">
                            <div class="col-sm-6">
                                <img
                                    src="/img/how.png"
                                    alt="Image"
                                    class="info-card-pic"
                                />
                            </div>
                            <div class="col-sm-6 info-card-text">
                                <h3>How?</h3>
                                <p>
                                    Participants can gain points by completing
                                    daily challenge and submitting photos or
                                    videos.
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 info-card reveal">
                        <div class="row info-card-row">
                            <div class="col-sm-6">
                                <img
                                    src="/img/when.png"
                                    alt="Image"
                                    class="info-card-pic"
                                />
                            </div>
                            <div class="col-sm-6 info-card-text">
                                <h3>When?</h3>
                                <p>
                                    This challenge will last for 28 days, from
                                    20th March to 16th April
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <hr />
                <!--Daily Challenges-->
                <div class="row">
                    <div class="col-12 reveal" id="daily-challenge">
                        <h1>Daily Challenges</h1>
                        <h4>Challenges will begin to release on 20th March.</h4>
                        <div class="challenge-container">
                            <figure class="challenge-figure">
                                <img
                                    src="/img/challenge-picture.png"
                                    alt="challenge-picture"
                                    id="challenge-picture"
                                />
                                <figcaption>Stay Tuned!</figcaption>
                            </figure>
                        </div>
                    </div>
                </div>
                <hr />
                <!--Questions?-->
                <div class="row">
                    <div class="col-12">
                        <h1>Questions?</h1>
                        <p>
                            Contact
                            <span style="text-decoration: underline"
                                >thewontedproject@gmail.com</span
                            >
                            for more information on the project
                        </p>
                    </div>
                </div>
            </section>

            <link
                rel="stylesheet"
                href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
            />

            <div class="footer-dark">
                <footer>
                    <div class="container">
                        <div class="row footer-text">
                            <h3>Go-Green Challenge</h3>
                            <p>
                                Join us in going green for the sake of our
                                environment!
                            </p>
                        </div>
                        <div class="col item social">
                            <!-- Instagram -->
                            <span class="indiv-social">
                                <a
                                    target="_blank"
                                    href="https://www.instagram.com/thewontedproject/"
                                >
                                    <i class="fa fa-instagram"></i>
                                </a>
                                <span>@thewontedproject</span>
                                <br class="show-mobile" />
                            </span>

                            <!-- Email -->
                            <span class="indiv-social">
                                <a><i class="fa fa-envelope"></i></a>
                                <span>thewontedproject@gmail.com</span>
                                <br class="show-mobile" />
                            </span>

                            <!-- Address -->
                            <span class="indiv-social">
                                <a><i class="fa fa-home"></i></a>
                                <span>500 Dover Road Singapore 139651</span>
                                <br class="show-mobile" />
                            </span>
                        </div>
                        <div>
                            <p class="copyright">GoGreenChallenge © 2023</p>
                        </div>
                    </div>
                </footer>
            </div>
        </main>

        <!--bootstrap-->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
            integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"
            integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD"
            crossorigin="anonymous"
        ></script>

        <!-- script -->
        <script type="module">
            // Import the functions you need from the SDKs you need
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
            import {
                getAuth,
                onAuthStateChanged,
                signOut,
            } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-auth.js";
            import {
                getFirestore,
                doc,
                getDoc,
            } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-firestore.js";
            import { getStorage } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-storage.js";
            const firebaseConfig = {
                apiKey: "AIzaSyDQ4klRjnWy9N_HTvffLRChaR9f6aTx5xA",
                authDomain: "go-green-challenge.firebaseapp.com",
                projectId: "go-green-challenge",
                storageBucket: "go-green-challenge.appspot.com",
                messagingSenderId: "586047303749",
                appId: "1:586047303749:web:73a742cbefa66c0fbd732c",
                measurementId: "G-5WNGZ08ND0",
            };

            // Initialize Firebase
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);
            const storage = getStorage(app);

            // sign out button and username element
            let signInPageButton = document.querySelector("#signInPageButton");
            let signOutButton = document.querySelector("#signOutButton");
            let usernameDisplay = document.querySelector("#usernameDisplay");
            let totalScoreDisplay =
                document.querySelector("#totalScoreDisplay");
            let display = document.querySelector("#display");

            // Unhide sign out button and add username
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    signInPageButton.hidden = true;
                    signOutButton.hidden = false;
                    usernameDisplay.textContent = user.displayName;
                    getDoc(doc(db, "scores", user.uid))
                        .then((docSnap) => {
                            totalScoreDisplay.textContent =
                                docSnap.data().totalScore;
                            display.hidden = false;
                        })
                        .catch((error) => {
                            alert(
                                `Error code: ${error.code}\nError message: ${error.message}`
                            );
                        });
                }
            });

            // Sign out
            signOutButton.addEventListener("click", (e) => {
                e.preventDefault();
                signOut(auth)
                    .then(() => {
                        alert(
                            "Sign out is successful! Will redirect to home page."
                        );
                        location.assign("/");
                    })
                    .catch((error) => {
                        alert(
                            `Error code: ${error.code}\nError message: ${error.message}`
                        );
                        location.reload();
                    });
            });

            let startTime = new Date(2023, 2, 20).getTime();
            let endTime = new Date(2023, 3, 17).getTime();
            let todayTime = new Date(2023, 2, 20).getTime();
            // let todayTime = Date.now();

            //Element
            const challengeImage = document.querySelector("#daily-challenge");

            if (todayTime < startTime) {
                console.log("Challenge has not commenced");
            } else if (todayTime < endTime) {
                let dayDif = Math.floor((todayTime - startTime) / 86400000);
                let dayOfWeek = (dayDif % 7) + 1;
                let week = Math.ceil((dayDif + 1) / 7);

                console.log(`week: ${week}, day: ${dayOfWeek}`);

                // Daily challenge
                getDoc(doc(db, "challenges", `day${dayDif + 1}`))
                    .then((docSnap) => {
                        challengeImage.innerHTML = `
                        <h1>Daily Challenges</h1>
                        <h4>Week ${week}</h4>
                        <div class="challenge-container">
                            <a href="/ongoing-challenge.html">
                                <figure class="challenge-figure">
                                    <img src="http://drive.google.com/uc?id=${
                                        docSnap.data().img
                                    }" alt="challenge-picture" id="challenge-picture"/>
                                    <figcaption>
                                        Click to view challenges
                                    </figcaption>
                                </figure>
                            </a>
                        </div>
                    `;
                    })
                    .catch((error) => {
                        alert(
                            `Error code: ${error.code}\nError message: ${error.message}`
                        );
                    });
            } else {
                console.log("Challenge has ceased");

                // All challenges have ended
                challengeImage.innerHTML = `
                        <h1>Daily Challenges</h1>
                        <h4>All challenges have ended. Thank you for going green with us!</h4>
                        <div class="challenge-container">

                                <figure class="challenge-figure">
                                    <img src="/img/challenge-picture.png" alt="challenge-picture" id="challenge-picture" />
                                    <figcaption>
                                        No challenges remaining
                                    </figcaption>
                                </figure>

                        </div>
                    `;
            }
        </script>
    </body>
</html>
